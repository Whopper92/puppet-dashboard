From f2c3d549523daaf867423ab6e6dc09008b4af428 Mon Sep 17 00:00:00 2001
From: Joshua Harlan Lifton <lifton@puppetlabs.com>
Date: Tue, 20 Mar 2012 16:21:45 -0700
Subject: [PATCH] Fix regression in access control protections

---
 .../_node_manager_sidebar_for_type.html.haml       |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/app/views/shared/_node_manager_sidebar_for_type.html.haml b/app/views/shared/_node_manager_sidebar_for_type.html.haml
index 3a3694e..2564c8d 100644
--- a/app/views/shared/_node_manager_sidebar_for_type.html.haml
+++ b/app/views/shared/_node_manager_sidebar_for_type.html.haml
@@ -18,5 +18,5 @@
           = link_to h(entry.name), send(path_for_show, entry)
           %span.count= entry.nodes_count
   .footer.actionbar
-    - unless SETTINGS.enable_read_only_mode
+    - unless SETTINGS.enable_read_only_mode || session['ACCESS_CONTROL_ROLE'] == 'READ_ONLY'
       = link_to "Add #{h(label.downcase)}", send(path_for_new), :class => 'button'
-- 
1.7.5.4

